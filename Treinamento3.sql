--SUB CONSULTAS

SELECT COD_CONTRATO, DATA, TOTAL
FROM TCONTRATO 
WHERE TOTAL >=
    (SELECT VALOR FROM TCURSO
     WHERE COD_CURSO = 3);
     
--Criar tabela     
CREATE TABLE TDESCONTO
( CLASSE VARCHAR(2),
  INFERIOR INTEGER,
  SUPERIOR INTEGER);
  
--Inserir valores na Tabela  

INSERT INTO TDESCONTO VALUES ('A',00,10);
INSERT INTO TDESCONTO VALUES ('B',11,15);
INSERT INTO TDESCONTO VALUES ('C',16,20);
INSERT INTO TDESCONTO VALUES ('D',21,25);
INSERT INTO TDESCONTO VALUES ('E',26,30);

SELECT * FROM TDESCONTO

--Inserir linhas atraves de variaveis de substituição
INSERT INTO TDESCONTO(CLASSE, INFERIOR, SUPERIOR)
VALUES ('&cla', &inf, &sup);

--Substituir valores
UPDATE TDESCONTO SET
INFERIOR = &inf,
SUPERIOR = &sup
WHERE CLASSE = '&cla';

--Select com variaveis
SELECT *FROM TDESCONTO
WHERE CLASSE = '&cla';

--Delete com variaveis
DELETE FROM TDECONTO
WHERE CLASSE = '&cla';

--Criar tabela com a mesma forma de uma ja existente
CREATE TABLE TDESCONTO2
 AS SELECT *FROM TDESCONTO

--Delete nos registros da tabela 
DELETE FROM TDESCONTO2;
--Desfazer delete nos registros da tabela
ROLLBACK;
 
SELECT *FROM TDESCONTO2

--Deleta todos so registros da tabela
--não tem clausula where (não adianta rollback)
TRUNCATE TABLE TDESCONTO2;

--Savepoint - cria ponto de restauração
SAVEPOINT upd_a

--Vizualizar tabelas criadas pelo usuario
SELECT * FROM USER_TABLES;
--Vizualizar os tipos de objetos distintos criados pelo usuario
SELECT * FROM USER_OBJECTS;
--Vizualizar tabelas,visões,sinonimos e sequencias criada pelo usuario
SELECT * FROM USER_CATALOG;

--Adicionar coluna na tabela
ALTER TABLE TCONTRATO ADD VALOR NUMBER(5,2);
--Alterar coluna
ALTER TABLE TCONTRATO MODIFY VALOR NUMBER(8,20);
--Renomear coluna
ALTER TABLE TCONTRATO RENAME COLUMN VALOR TO VALOR2;
--Excluir coluna
ALTER TABLE TCONTRATO DROP COLUMN VALOR2;
--Excluir tabela
DROP TABLE TESTE;
--Renomear tabela
RENAME TCONTRATO TO TCONTRATO1;
RENAME TCONTRATO1 TO TCONTRATO;

--Desabilita a coluna
ALTER TABLE TCONTRATO ADD TOTAL2 NUMERIC(8,2);--Coluna inserida pra teste
ALTER TABLE TCONTRATO SET UNUSED(TOTAL2)
--Exluir colunas desabilitadas
ALTER TABLE TCONTRATO DROP UNUSED COLUMNS;

--Comentario na tabela
COMMENT ON TABLE TCONTRATO IS 'informaçoes de contrato';
--Comentario na coluna da tabela
COMMENT ON COLUMN TCONTRATO.COD_CONTRATO IS 'codigo do contrato';

--constraints
SELECT * FROM USER_CONSTRAINTS;

CREATE TABLE TCIDADE 
( COD_CIDADE INTEGER NOT NULL,
  NOME VARCHAR(40),
  CONSTRAINT PK_cidade primary key(cod_cidade)
); 

CREATE TABLE TBAIRRO
( COD_CIDADE INTEGER NOT NULL,
  COD_BAIRRO INTEGER NOT NULL,
  NOME       VARCHAR2(40),
  CONSTRAINT PK_BAIRRO PRIMARY KEY(COD_CIDADE,COD_BAIRRO)
);

--Add chave estrangera (FK)
ALTER TABLE TBAIRRO ADD CONSTRAINT FK_COD_CIDADE
FOREIGN KEY (COD_CIDADE)
REFERENCES TCIDADE(COD_CIDADE);

CREATE TABLE TRUA
( COD_RUA INTEGER NOT NULL,
  COD_CIDADE INTEGER,
  COD_BAIRRO INTEGER,
  NOME VARCHAR(40),
  CONSTRAINT PK_RUA PRIMARY KEY(COD_RUA)
);  

--Chave estrangeira liga tabela rua a tabela bairro
ALTER TABLE TRUA ADD CONSTRAINT FK_CIDADEBAIRRO
FOREIGN KEY(COD_CIDADE, COD_BAIRRO)
REFERENCES TBAIRRO(COD_CIDADE,COD_BAIRRO);


CREATE TABLE TPESSOA
( COD_PESSOA INTEGER    NOT NULL,
  TIPO       VARCHAR(1) NOT NULL,
  NOME       VARCHAR(30)NOT NULL,
  PESSOA     VARCHAR(1) NOT NULL,
  COD_RUA    INTEGER    NOT NULL,
  CPF        VARCHAR(15),
  CONSTRAINT PK_PESSOA PRIMARY KEY(COD_PESSOA)
); 

--unique key  (campo unico)
ALTER TABLE TPESSOA ADD CONSTRAINT UK_CPF UNIQUE(CPF);

--Chave q une as tabelas rua/pessoas
ALTER TABLE TPESSOA ADD CONSTRAINT FK_PESSOA_RUA
FOREIGN KEY (COD_RUA)
REFERENCES TRUA;

--Insert tabela tcidade
INSERT INTO TCIDADE VALUES(1,'NOVO HAMBURGO');
INSERT INTO TCIDADE VALUES(2,'IVOTI');
INSERT INTO TCIDADE VALUES(3,'SAPIRANGA');
INSERT INTO TCIDADE VALUES(4,'TAQUARA');

SELECT * FROM TCIDADE

--Insert tabela Tbairro
INSERT INTO TBAIRRO VALUES(1,1,'CENTRO');
INSERT INTO TBAIRRO VALUES(2,1,'RIO BRANCO');
INSERT INTO TBAIRRO VALUES(3,1,'CENTRO'); 
INSERT INTO TBAIRRO VALUES(4,1,'FRITZ');

SELECT * FROM TBAIRRO

--Insert rua
INSERT INTO TRUA VALUES(1,1,1,'MARCILIO DIAS');
INSERT INTO TRUA VALUES(2,2,1,'FRITZ');
INSERT INTO TRUA VALUES(3,3,1,'JACOBINA');
INSERT INTO TRUA VALUES(4,3,1,'JOÃO DA SILVA');

SELECT * FROM TRUA ORDER BY COD_RUA;

--Check
ALTER TABLE TPESSOA ADD CONSTRAINT CK_PESSOA_TIPO
CHECK (TIPO IN ('C','F'));

SELECT * FROM TPESSOA
--Insert com restrições
INSERT INTO TPESSOA VALUES(2,'F','MARIA','J',2,'12345');
INSERT INTO TPESSOA VALUES(3,'F','PEDRO','J',4,'132456');
INSERT INTO TPESSOA VALUES(4,'C','LAURA','F',3,'4251');

--Foreign key drop(apagar constraint)
ALTER TABLE TPESSOA DROP CONSTRAINT NOME_DA_CONSTRAINT

--Desabilitando/habilitando constraint
ALTER TABLE TPESSOA DISABLE CONSTRAINT UK_CPF;
ALTER TABLE TPESSOA ENABLE CONSTRAINT UK_CPF;






